<!DOCTYPE html>
<html lang="en">
  <head>
  
      <title>mcc - The First article</title>

<meta charset="utf-8" />
<meta name="generator" content="Pelican" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<link rel="icon" type="image/x-icon" href="/theme/favicon.ico">

<!-- Core CSS -->
<link rel="stylesheet" href="/theme/css/main.css">





    <meta name="tags" content="New" />
    <meta name="tags" content="moral" />

  </head>

  <body>
    <div class="flex flex-col min-h-screen">

<header class="sticky top-0 z-50 w-full bg-white/90 backdrop-blur-md shadow-sm">
    <div class="container flex items-center justify-between h-20">
      <a href="/" class="text-2xl font-bold text-primary-800 font-serif flex items-center">
        <span class="sr-only">Church Name</span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="h-12 w-auto text-primary-600 mr-2">
          <path fill="currentColor" d="M344 24c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 24-32 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l32 0 0 46.4L183.3 210c-14.5 8.7-23.3 24.3-23.3 41.2L160 512l96 0 0-96c0-35.3 28.7-64 64-64s64 28.7 64 64l0 96 96 0 0-260.8c0-16.9-8.8-32.5-23.3-41.2L344 142.4 344 96l32 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-32 0 0-24zM24.9 330.3C9.5 338.8 0 354.9 0 372.4L0 464c0 26.5 21.5 48 48 48l80 0 0-238.4L24.9 330.3zM592 512c26.5 0 48-21.5 48-48l0-91.6c0-17.5-9.5-33.6-24.9-42.1L512 273.6 512 512l80 0z"/>
        </svg>
        <span class="text-primary-800">Church Name</span>
      </a>


<!-- Desktop Navigation -->
<nav class="hidden lg:block">
  <ul class="flex items-center space-x-6 capitalize">

          <li>
            <a
              href="/pages/about.html"
              class="text-base font-medium transition-colors hover:text-primary-600 text-gray-700"
            >
              About
            </a>
          </li>
          <li>
            <a
              href="/"
              class="text-base font-medium transition-colors hover:text-primary-600 text-gray-700"
            >
              I'm New
            </a>
          </li>
          <li>
            <a
              href="/"
              class="text-base font-medium transition-colors hover:text-primary-600 text-gray-700"
            >
              Staff
            </a>
          </li>
          <li>
            <a
              href="/"
              class="text-base font-medium transition-colors hover:text-primary-600 text-gray-700"
            >
              Contact
            </a>
          </li>

    <!-- GitHub Icon -->
    <li>
      <a
        href="https://github.com/"
        target="_blank"
        rel="noopener noreferrer"
        class="text-gray-700 hover:text-primary-600 transition-colors p-2"
        aria-label="View on GitHub"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
        </svg>
      </a>
    </li>
  </ul>
</nav>


<!-- Mobile Menu Button -->
<button
  id="mobile-menu-button"
  class="lg:hidden p-2 text-gray-700 hover:text-primary-600 focus:outline-none transition-colors relative"
  aria-label="Toggle Menu"
  aria-expanded="false"
>
  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
  </svg>
</button>

<!-- Mobile Menu Dropdown - Compact & Clean -->
<div
  id="mobile-menu"
  class="absolute top-full left-0 right-0 bg-white shadow-lg border-t border-gray-100 transform scale-y-0 origin-top transition-transform duration-200 ease-out lg:hidden z-50"
  role="menu"
  aria-labelledby="mobile-menu-button"
>
  <!-- Navigation Links in Grid -->
  <div class="px-4 py-6">
    <div class="grid grid-cols-2 gap-3 capitalize">


          <a
            href="/pages/about.html"
            role="menuitem"
            class="block px-4 py-3 text-sm font-medium rounded-lg transition-colors text-center text-gray-700 hover:bg-gray-50 hover:text-primary-600 border border-transparent"
          >
            About
          </a>
          <a
            href="/"
            role="menuitem"
            class="block px-4 py-3 text-sm font-medium rounded-lg transition-colors text-center text-gray-700 hover:bg-gray-50 hover:text-primary-600 border border-transparent"
          >
            I'm New
          </a>
          <a
            href="/"
            role="menuitem"
            class="block px-4 py-3 text-sm font-medium rounded-lg transition-colors text-center text-gray-700 hover:bg-gray-50 hover:text-primary-600 border border-transparent"
          >
            Staff
          </a>
          <a
            href="/"
            role="menuitem"
            class="block px-4 py-3 text-sm font-medium rounded-lg transition-colors text-center text-gray-700 hover:bg-gray-50 hover:text-primary-600 border border-transparent"
          >
            Contact
          </a>

    </div>

    <!-- GitHub Link -->
    <div class="mt-4 pt-4 border-t border-gray-100">
      <a
        href="https://github.com/"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center justify-center px-4 py-3 text-sm font-medium text-gray-600 hover:text-primary-600 transition-colors rounded-lg hover:bg-gray-50"
        role="menuitem"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
        </svg>
        View on GitHub
      </a>
    </div>
  </div>
</div>

    </div>
</header>
        <main class="flex-grow">

<section
  class="relative py-20 bg-cover bg-center"
  style="background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('/images/1.webp')"
>
  <div class="container">
    <div class="max-w-3xl mx-auto text-center text-white">
      <h1 class="text-4xl md:text-5xl font-bold mb-4 text-white">
          The First article
      </h1>
    </div>
  </div>
</section>
  <section class="py-8">
    <div class="container mx-auto max-w-3xl">
      <div class="mb-8 overflow-hidden rounded-lg">
        <img
          src="/images/1.webp"
          alt="The First article"
          class="object-cover w-full h-64 md:h-96"
          widths="[320, 640, 1024]"
          format="webp"
          loading="lazy"
        />
      </div>
    </div>
  </section>

  <article class="mx-auto max-w-3xl pb-20">
    <h2>
      <a
        href="/article-1.html" rel="bookmark"
        title="Permalink to The First article"
      >
        The First article
      </a>
    </h2>


    

    <p>I’ve been in the process of coding a web crawler in Rust and faced a problem with keeping an in-memory to-visit queue. The idea is to have a collection of nodes to visit, which discards duplicates, with minimal memory overhead.</p>
<p>The Problem<br>
A problem like this could be solved by using a simple set. Before inserting a new element, we check for membership into the visited set and discard duplicates.</p>
<p>In the following examples, rust is used, and elements are Strings, coming from crawled web pages.</p>
<p>pub struct Sieve {
    filter: HashSet<String>,
    urls: VecDeque<String>,
}</p>
<p>impl Sieve {
    pub fn new() -&gt; Sieve {
        Sieve {
            filter: HashSet::new(),
            urls: VecDeque::new(),
        }
    }</p>
<div class="highlight"><pre><span></span><code><span class="nt">pub</span><span class="w"> </span><span class="nt">fn</span><span class="w"> </span><span class="nt">push</span><span class="o">(&amp;</span><span class="nt">mut</span><span class="w"> </span><span class="nt">self</span><span class="o">,</span><span class="w"> </span><span class="nt">url</span><span class="o">:</span><span class="w"> </span><span class="nt">String</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">self.filter.contains(&amp;url)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="err">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nt">self</span><span class="p">.</span><span class="nc">filter</span><span class="p">.</span><span class="nc">insert</span><span class="o">(</span><span class="nt">url</span><span class="p">.</span><span class="nc">clone</span><span class="o">());</span>
<span class="w">    </span><span class="nt">self</span><span class="p">.</span><span class="nc">urls</span><span class="p">.</span><span class="nc">push_back</span><span class="o">(</span><span class="nt">url</span><span class="o">);</span>
<span class="err">}</span>

<span class="nt">pub</span><span class="w"> </span><span class="nt">fn</span><span class="w"> </span><span class="nt">pop</span><span class="o">(&amp;</span><span class="nt">mut</span><span class="w"> </span><span class="nt">self</span><span class="o">)</span><span class="w"> </span><span class="nt">-</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">Option</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">self.urls.pop_front()</span>
<span class="p">}</span>
</code></pre></div>

<p>}
This should be fine right? The answer is yes if the elements you add to it are limited, otherwise, the memory consumption of the set grows indefinitely.</p>
<p>We can do better by relying on the same ideas but with a different Set implementation.</p>
<p>Bloom Filters 
A Bloom Filters is a space-efficient probabilistic data structure. It can be used to answer membership queries with one caveat, it makes errors with a certain probability.</p>
<p>The Algorithm 
An Bloom Filter is composed by two elements:</p>
<p>A bit array of 
m
m bits, initially set to zero;
d
d hash functions, where 
d
d is a small constant.
Adding an element</p>
<p>To add a new element, we feed it to the 
d
d hash functions, obtaining 
d
d indexes in the range 
[
0
,
m
−
1
]
[0,m−1], used to set these positions to one in the bit array.</p>
<p>Checking for membership</p>
<p>As for insertion, we compute 
d
d hash values, and then check if all those bits are set to one in the bit array.</p>
<p>Dealing with False Positives 
A Filter is constructed with two parameters in mind: the number of expected insertions, and the wanted false-positive rate. Those two quantities determine the required number of bits and hash functions in the structure.</p>
<p>Given 
n
n the number of wanted elements, and 
ϵ
ϵ the wanted false positive rate, the following holds:
m
=
−
n
∗
ln
⁡
(
p
)
ln
⁡
(
2
)
2
m=− 
ln(2) 
2</p>
<p>n∗ln(p)
​</p>
<p>The number of hash functions can be computed as:
d
=
−
ln
⁡
(
p
)
ln
⁡
(
2
)
d=− 
ln(2)
ln(p)
​</p>
<p>As those relations hold, we can balance the tradeoffs between speed, as more hash functions mean more bits to set and false-positive rate.</p>
<p>Practical Hash Computation 
We do not want to compute an excessive number of hash functions, as they can be quite costly. An easy way to reduce the required number of hash computations is to compute two hash values and combine them like so:</p>
<p>h
i
=
h
1
+
h
2
∗
i
h 
i
​
 =h 
1
​
 +h 
2
​
 ∗i</p>
<p>To compute two different hash values we can hash an element once and split the hash bits in two.</p>
<p>Implementation 
Here is a practical implementation of the Bloom Filter. To represent a bit array we use a vector of 128 bit numbers where each bit is considered as a different position.</p>
<p>pub struct Filter {
    size: usize,
    d: u32,
    bits: Vec<u128>,
    set_bits: u32,
}
Construction</p>
<p>Given the expected number of insertions and false-positive rate, we compute the optimal number of bits to use.</p>
<p>pub fn new(n: usize, p: f64) -&gt; Filter {
    let log_2 = 2_f64.ln();
    let log_p = p.ln();</p>
<div class="highlight"><pre><span></span><code>let size = ((-(n as f64) <span class="gs">* log_p) / (log_2 *</span> log_2)) as usize;
let d = (-log_p / log_2).ceil() as u32;
let bits = vec![0; (size as f64 / 128.0).ceil() as usize];
let set_bits = 0;

Filter {
    size,
    d,
    bits,
    set_bits,
}
</code></pre></div>

<p>}
Insertion</p>
<p>We compute 
d
d hash values and use them to set the corresponding bits in the bit array.</p>
<p>pub fn add(&amp;mut self, data: &amp;[u8]) {
    let (h1, h2) = Self::hash(data);</p>
<div class="highlight"><pre><span></span><code>for i in 0..self.d {
    let bit = (h1 as u128 + h2 as u128 * i as u128) as usize % self.size;
    self.bits[bit / 128] |= 1 &lt;&lt; (bit % 128);
}
</code></pre></div>

<p>}
Membership Queries</p>
<p>We compute 
d
d hash values and use them to check that the bits are all set.</p>
<p>pub fn contains(&amp;mut self, data: &amp;[u8]) -&gt; bool {
    let (h1, h2) = Self::hash(data);</p>
<div class="highlight"><pre><span></span><code>for i in 0..self.d {
    let bit = (h1 as u128 + h2 as u128 * i as u128) as usize % self.size;
    if self.bits[bit / 128] &amp; (1 &lt;&lt; (bit % 128)) == 0 {
        return false;
    }
}
true
</code></pre></div>

<p>}
Estimating size</p>
<p>Size can be estimated with a simple formula:</p>
<h1>s</h1>
<p>−
m
d
ln
⁡
[
1
−
X
m
]
s=− 
d
m
​
 ln[1− 
m
X
​
 ]</p>
<p>Where 
X
X is the number of bits set to one.</p>
<p>pub fn estimated_size(&amp;self) -&gt; usize {
    (-(self.size as f64 / self.d as f64)
        * (1f64 - self.set_bits as f64 / self.size as f64).ln()) as usize
}
We hence need a new value, set_bits, which can be updated on each insertion. Here is the tweaked add function.</p>
<p>pub fn add(&amp;mut self, data: &amp;[u8]) {
    ...
    // subtract old number of set bits in this block
    self.set_bits -= self.bits[bit / 128].count_ones();
    // set bit to one
    self.bits[bit / 128] |= 1 &lt;&lt; (bit % 128);
    // add new number of set bits in this block
    self.set_bits += self.bits[bit / 128].count_ones();  <br>
    ...
}
Full Implementation</p>
<p>Wrapping everything up, here is the complete Bloom Filter implementation.</p>
<p>pub struct Filter {
    size: usize,
    d: u32,
    bits: Vec<u128>,
    set_bits: u32,
}</p>
<p>impl Default for Filter {
    fn default() -&gt; Self {
        Self::new(1_000_000, 0.01)
    }
}</p>
<p>impl Filter {
    pub fn new(n: usize, p: f64) -&gt; Filter {
        let log_2 = 2_f64.ln();
        let log_p = p.ln();</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f64</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">log_p</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">log_2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">log_2</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">usize</span><span class="p">;</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">log_p</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">log_2</span><span class="p">).</span><span class="n">ceil</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u32</span><span class="p">;</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="err">!</span><span class="o">[</span><span class="n">0; (size as f64 / 128.0).ceil() as usize</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">set_bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">Filter</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">size</span><span class="p">,</span>
<span class="w">        </span><span class="n">d</span><span class="p">,</span>
<span class="w">        </span><span class="n">bits</span><span class="p">,</span>
<span class="w">        </span><span class="n">set_bits</span><span class="p">,</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>

<span class="n">pub</span><span class="w"> </span><span class="n">fn</span><span class="w"> </span><span class="k">add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mut</span><span class="w"> </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="err">:</span><span class="w"> </span><span class="o">&amp;[</span><span class="n">u8</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="p">(</span><span class="n">h1</span><span class="p">,</span><span class="w"> </span><span class="n">h2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nl">Self</span><span class="p">:</span><span class="err">:</span><span class="n">hash</span><span class="p">(</span><span class="k">data</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mf">0.</span><span class="p">.</span><span class="n">self</span><span class="p">.</span><span class="n">d</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">let</span><span class="w"> </span><span class="nc">bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">h1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u128</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h2</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u128</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u128</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">usize</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="k">size</span><span class="p">;</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">set_bits</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">bits</span><span class="o">[</span><span class="n">bit / 128</span><span class="o">]</span><span class="p">.</span><span class="n">count_ones</span><span class="p">();</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">bits</span><span class="o">[</span><span class="n">bit / 128</span><span class="o">]</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="nc">bit</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">128</span><span class="p">);</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">set_bits</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">bits</span><span class="o">[</span><span class="n">bit / 128</span><span class="o">]</span><span class="p">.</span><span class="n">count_ones</span><span class="p">();</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>

<span class="n">pub</span><span class="w"> </span><span class="n">fn</span><span class="w"> </span><span class="k">contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mut</span><span class="w"> </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="err">:</span><span class="w"> </span><span class="o">&amp;[</span><span class="n">u8</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="p">(</span><span class="n">h1</span><span class="p">,</span><span class="w"> </span><span class="n">h2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nl">Self</span><span class="p">:</span><span class="err">:</span><span class="n">hash</span><span class="p">(</span><span class="k">data</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mf">0.</span><span class="p">.</span><span class="n">self</span><span class="p">.</span><span class="n">d</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">let</span><span class="w"> </span><span class="nc">bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">h1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u128</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h2</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u128</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u128</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">usize</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="k">size</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">bits</span><span class="o">[</span><span class="n">bit / 128</span><span class="o">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="nc">bit</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">128</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="k">true</span>
<span class="err">}</span>

<span class="n">pub</span><span class="w"> </span><span class="n">fn</span><span class="w"> </span><span class="n">estimated_size</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">usize</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="k">size</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f64</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f64</span><span class="p">)</span>
<span class="w">        </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="n">f64</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">set_bits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f64</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="k">size</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f64</span><span class="p">).</span><span class="k">ln</span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">usize</span>
<span class="err">}</span>

<span class="n">fn</span><span class="w"> </span><span class="n">hash</span><span class="p">(</span><span class="k">data</span><span class="err">:</span><span class="w"> </span><span class="o">&amp;[</span><span class="n">u8</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">u64</span><span class="p">,</span><span class="w"> </span><span class="n">u64</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nl">fastmurmur3</span><span class="p">:</span><span class="err">:</span><span class="n">hash</span><span class="p">(</span><span class="k">data</span><span class="p">);</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="nl">mask</span><span class="p">:</span><span class="w"> </span><span class="n">u128</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">((</span><span class="n">h</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">mask</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u64</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u64</span><span class="p">)</span>
<span class="err">}</span>
</code></pre></div>

<p>}
Memory Footprint 
A great property of those Filters is that their memory footprint is fixed, independent of how many elements we store. What degrades is the false positive rate, until it reaches one. What degrades is the false positive rate, until it reaches one.</p>
<p>The space efficiency is amazing, for instance, 1 Billion elements, with a false positive rate of 0.01% can be stored in just over 18mb.</p>
<p>The Solution 
Here is the final solution to this problem. The Sieve struct now accepts a parameter indicating the expected number of elements that are enqueued. Once we surpass this threshold, the filter performance starts to deteriorate.</p>
<p>use log::warn;</p>
<p>pub struct Sieve {
    filter: Filter,
    urls: VecDeque<String>,
    expected_size: usize,
}</p>
<p>impl Sieve {
    pub fn new(expected_urls_num: usize) -&gt; Sieve {
        Sieve {
            filter: Filter::new(expected_urls_num, 0.01),
            urls: VecDeque::new(),
            expected_size: expected_urls_num,
        }
    }</p>
<div class="highlight"><pre><span></span><code><span class="nt">pub</span><span class="w"> </span><span class="nt">fn</span><span class="w"> </span><span class="nt">push</span><span class="o">(&amp;</span><span class="nt">mut</span><span class="w"> </span><span class="nt">self</span><span class="o">,</span><span class="w"> </span><span class="nt">url</span><span class="o">:</span><span class="w"> </span><span class="nt">String</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">let</span><span class="w"> </span><span class="err">url_bytes</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">url.as_bytes()</span><span class="p">;</span>

<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">self.filter.contains(url_bytes)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="err">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nt">self</span><span class="p">.</span><span class="nc">filter</span><span class="p">.</span><span class="nc">add</span><span class="o">(</span><span class="nt">url_bytes</span><span class="o">);</span>
<span class="w">    </span><span class="nt">self</span><span class="p">.</span><span class="nc">urls</span><span class="p">.</span><span class="nc">push_back</span><span class="o">(</span><span class="nt">url</span><span class="o">);</span>

<span class="w">    </span><span class="nt">let</span><span class="w"> </span><span class="nt">filter_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">self</span><span class="p">.</span><span class="nc">filter</span><span class="p">.</span><span class="nc">estimated_size</span><span class="o">();</span>
<span class="w">    </span><span class="nt">if</span><span class="w"> </span><span class="nt">filter_size</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nt">self</span><span class="p">.</span><span class="nc">expected_size</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">warn!(</span>
<span class="w">            </span><span class="err">&quot;Filter</span><span class="w"> </span><span class="err">size</span><span class="w"> </span><span class="err">({</span><span class="p">}</span><span class="o">)</span><span class="w"> </span><span class="nt">exceeds</span><span class="w"> </span><span class="nt">Sieve</span><span class="w"> </span><span class="nt">expected</span><span class="w"> </span><span class="nt">size</span><span class="w"> </span><span class="o">(</span><span class="p">{}</span><span class="o">)</span><span class="err">&quot;</span><span class="o">,</span>
<span class="w">            </span><span class="nt">filter_size</span><span class="o">,</span><span class="w"> </span><span class="nt">self</span><span class="p">.</span><span class="nc">expected_size</span>
<span class="w">        </span><span class="o">);</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>

<span class="nt">pub</span><span class="w"> </span><span class="nt">fn</span><span class="w"> </span><span class="nt">pop</span><span class="o">(&amp;</span><span class="nt">mut</span><span class="w"> </span><span class="nt">self</span><span class="o">)</span><span class="w"> </span><span class="nt">-</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">Option</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">self.urls.pop_front()</span>
<span class="p">}</span>
</code></pre></div>

<p>}
Thank you for reading this far, feel free to get in touch for suggestions or clarifications! Have a nice day 😃</p>
    <footer>
      <p>Published: <time datetime="2024-07-04T00:00:00+02:00">
        Thu 04 July 2024
      </time></p>
        <address>
          By             <a href="/author/jack.html">Jack</a>
        </address>
        <p>
          Category: <a href="/category/tech.html">Tech</a>
        </p>
        <p>
          Tags:
            <a href="/tag/new.html">New</a>
            <a href="/tag/moral.html">moral</a>
        </p>
    </footer>
  </article>
        </main>


<footer class="bg-gray-900 text-white pt-16 pb-8">
  <div class="container">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
      <!-- Church Info -->
      <div>
        <div class="mb-4">
          <a href="/" class="text-2xl font-bold text-white font-serif inline-flex items-center">
            <span class="sr-only">Church Name</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="h-12 w-auto text-white mr-2">
              <path fill="currentColor" d="M344 24c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 24-32 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l32 0 0 46.4L183.3 210c-14.5 8.7-23.3 24.3-23.3 41.2L160 512l96 0 0-96c0-35.3 28.7-64 64-64s64 28.7 64 64l0 96 96 0 0-260.8c0-16.9-8.8-32.5-23.3-41.2L344 142.4 344 96l32 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-32 0 0-24zM24.9 330.3C9.5 338.8 0 354.9 0 372.4L0 464c0 26.5 21.5 48 48 48l80 0 0-238.4L24.9 330.3zM592 512c26.5 0 48-21.5 48-48l0-91.6c0-17.5-9.5-33.6-24.9-42.1L512 273.6 512 512l80 0z"/>
            </svg>
            <span>Church Name</span>
          </a>
        </div>

        <address class="not-italic mb-4 text-gray-300">
          <p>123 Main Street</p>
          <p>Anytown, ST 12345</p>
          <p class="mt-2">
            <a href="tel:+15551234567" class="hover:text-primary-300">(555) 123-4567</a>
          </p>
          <p>
            <a href="mailto:info@churchname.org" class="hover:text-primary-300">info@churchname.org</a>
          </p>
        </address>

        <!-- Office Hours -->
        <div class="mt-4 text-gray-300">
          <h4 class="text-sm font-bold mb-2 text-white">Office Hours</h4>

            <div class="text-sm prose prose-sm prose-invert max-w-none [&_h3]:text-white [&_h3]:text-sm [&_h3]:font-bold [&_h3]:mb-2 [&_ul]:list-none [&_ul]:p-0 [&_li]:mb-1 [&_strong]:text-white">
              
    <div><strong class="text-white">Mon-Fri:</strong> 9:00 AM - 5:00 PM</div>
    <div><strong class="text-white">Saturday:</strong> 9:00 AM - 1:00 PM</div>
    <div><strong class="text-white">Sunday:</strong> Closed (except services)</div>

            </div>
        </div>

        <!-- Social Links -->
        <div class="flex space-x-4 mt-6">
            <a
              href="https://facebook.com"
              target="_blank"
              rel="noopener noreferrer"
              class="text-gray-400 hover:text-white transition-colors"
              aria-label="Facebook"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
            </a>
            <a
              href="https://instagram.com"
              target="_blank"
              rel="noopener noreferrer"
              class="text-gray-400 hover:text-white transition-colors"
              aria-label="Instagram"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
            </a>
            <a
              href="https://youtube.com"
              target="_blank"
              rel="noopener noreferrer"
              class="text-gray-400 hover:text-white transition-colors"
              aria-label="Youtube"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
            </a>
        </div>
      </div>

      <!-- Navigation Groups -->
        <div>
          <h4 class="text-lg font-bold mb-4 text-white">About</h4>
          <ul class="space-y-2">
              <li>
                <a href="/" class="text-gray-300 hover:text-primary-300 transition-colors">
                  About Us
                </a>
              </li>
              <li>
                <a href="/" class="text-gray-300 hover:text-primary-300 transition-colors">
                  I'm New
                </a>
              </li>
              <li>
                <a href="/" class="text-gray-300 hover:text-primary-300 transition-colors">
                  Staff
                </a>
              </li>
              <li>
                <a href="/" class="text-gray-300 hover:text-primary-300 transition-colors">
                  Contact
                </a>
              </li>
          </ul>
        </div>
        <div>
          <h4 class="text-lg font-bold mb-4 text-white">Resources</h4>
          <ul class="space-y-2">
              <li>
                <a href="/" class="text-gray-300 hover:text-primary-300 transition-colors">
                  Sermons
                </a>
              </li>
              <li>
                <a href="/" class="text-gray-300 hover:text-primary-300 transition-colors">
                  Events
                </a>
              </li>
              <li>
                <a href="/" class="text-gray-300 hover:text-primary-300 transition-colors">
                  Blog
                </a>
              </li>
              <li>
                <a href="/" class="text-gray-300 hover:text-primary-300 transition-colors">
                  Ministries
                </a>
              </li>
          </ul>
        </div>
        <div>
          <h4 class="text-lg font-bold mb-4 text-white">Connect</h4>
          <ul class="space-y-2">
              <li>
                <a href="/about-us" class="text-gray-300 hover:text-primary-300 transition-colors">
                  Giving
                </a>
              </li>
              <li>
                <a href="/im-new" class="text-gray-300 hover:text-primary-300 transition-colors">
                  Prayer Request
                </a>
              </li>
              <li>
                <a href="/about-us" class="text-gray-300 hover:text-primary-300 transition-colors">
                  Newsletter
                </a>
              </li>
              <li>
                <a href="/im-new" class="text-gray-300 hover:text-primary-300 transition-colors">
                  Volunteer
                </a>
              </li>
          </ul>
        </div>
    </div>

    <!-- Copyright -->
    <div class="pt-8 mt-8 border-t border-gray-800 text-center text-gray-400 text-sm">
      <p>&copy; 2025 mcc. All rights reserved.</p>
      <p class="mt-2">
        <a href="/privacy-policy" class="hover:text-primary-300 mr-4">Privacy Policy</a>
        <a href="/terms-of-service" class="hover:text-primary-300">Terms of Service</a>
      </p>
    </div>
  </div>
</footer>



          <script src="/theme/js/main.js"></script>


    </div>
  </body>
</html>